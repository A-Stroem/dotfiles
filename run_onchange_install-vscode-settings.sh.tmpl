#!/usr/bin/env bash
# ============================================================
# Configure VS Code settings (non-destructive)
# ============================================================

set -euo pipefail

if ! command -v chezmoi >/dev/null 2>&1; then
  echo "WARN: chezmoi not found in PATH; skipping VS Code settings setup."
  exit 0
fi

CHEZMOI_SOURCE_DIR="$(chezmoi source-path 2>/dev/null || true)"
if [[ -z "$CHEZMOI_SOURCE_DIR" ]]; then
  echo "WARN: Could not determine chezmoi source path; skipping VS Code settings setup."
  exit 0
fi

INSTALL_SCRIPT="$CHEZMOI_SOURCE_DIR/scripts/install-vscode-settings.sh"
if [[ ! -f "$INSTALL_SCRIPT" ]]; then
  echo "WARN: VS Code installer script not found at $INSTALL_SCRIPT"
  exit 0
fi

bash "$INSTALL_SCRIPT" --theme {{ if eq .terminalTheme "dracula" }}"dracula"{{ else }}"gruvbox"{{ end }}
