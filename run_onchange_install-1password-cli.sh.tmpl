{{- if .isPersonal -}}
#!/usr/bin/env bash
# ============================================================
# 1Password CLI installation (PERSONAL MACHINES ONLY)
# ============================================================

set -euo pipefail

echo "üîê Installing 1Password CLI (personal machine)..."

# Check if already installed
if command -v op >/dev/null 2>&1; then
  echo "‚úÖ 1Password CLI already installed ($(op --version))"
  exit 0
fi

# ----------------------------
# macOS installation
# ----------------------------
if [[ "$(uname -s)" == "Darwin" ]]; then
  if ! command -v brew >/dev/null 2>&1; then
    echo "‚ùå Homebrew not found. Install brew first."
    exit 1
  fi
  
  brew install --cask 1password-cli
  echo "‚úÖ 1Password CLI installed via Homebrew"
  exit 0
fi

# ----------------------------
# Linux (Debian/Ubuntu) installation
# ----------------------------
if [[ "$(uname -s)" == "Linux" ]]; then
  echo "üì¶ Installing 1Password CLI for Linux..."
  
  # Install dependencies
  sudo apt update
  sudo apt install -y curl gnupg ca-certificates
  
  # Add 1Password repository
  curl -sS https://downloads.1password.com/linux/keys/1password.asc \
    | sudo gpg --dearmor -o /usr/share/keyrings/1password-archive-keyring.gpg
  
  echo "deb [arch=$(dpkg --print-architecture) signed-by=/usr/share/keyrings/1password-archive-keyring.gpg] https://downloads.1password.com/linux/debian/$(dpkg --print-architecture) stable main" \
    | sudo tee /etc/apt/sources.list.d/1password.list >/dev/null
  
  # Set repository priority
  sudo mkdir -p /etc/apt/preferences.d
  echo -e "Package: *\nPin: origin downloads.1password.com\nPin-Priority: 1000" \
    | sudo tee /etc/apt/preferences.d/1password >/dev/null
  
  # Install
  sudo apt update
  sudo apt install -y 1password-cli
  
  echo "‚úÖ 1Password CLI installed"
  exit 0
fi

echo "‚ùå Unsupported OS: $(uname -s)"
exit 1
{{- else -}}
#!/usr/bin/env bash
# Skipping 1Password CLI installation on work machine
echo "‚è≠Ô∏è  Skipping 1Password CLI (work machine - not needed)"
exit 0
{{- end -}}
