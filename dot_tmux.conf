# ============================================================
# tmux - optimized for multi-customer MSSP work
# ============================================================

# Change prefix from C-b to C-a (easier to reach)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable mouse support
set -g mouse on

# Increase history limit
set -g history-limit 100000

# Start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Enable clipboard integration
set -g set-clipboard on

# Reduce escape time (faster command sequences)
set -sg escape-time 10

# Increase display time for pane numbers
set -g display-panes-time 2000

# Enable focus events (for vim/neovim)
set -g focus-events on

# ----------------------------
# Splitting panes
# ----------------------------
# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window in current path
bind c new-window -c "#{pane_current_path}"

# ----------------------------
# Pane navigation (vim-style)
# ----------------------------
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# ----------------------------
# Pane resizing
# ----------------------------
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# ----------------------------
# Configuration reload
# ----------------------------
bind r source-file ~/.tmux.conf \; display-message "tmux.conf reloaded"

# ----------------------------
# Copy mode (vim-style)
# ----------------------------
setw -g mode-keys vi
bind -T copy-mode-vi v send -X begin-selection
bind -T copy-mode-vi y send -X copy-selection-and-cancel
bind -T copy-mode-vi C-v send -X rectangle-toggle

# Copy to system clipboard (platform-specific)
# macOS
if-shell "uname | grep -q Darwin" \
  "bind -T copy-mode-vi y send -X copy-pipe-and-cancel 'pbcopy'"

# Linux (WSL or native)
if-shell "uname | grep -q Linux" \
  "bind -T copy-mode-vi y send -X copy-pipe-and-cancel 'xclip -in -selection clipboard'"

# ----------------------------
# Status bar - Customer context awareness
# ----------------------------
set -g status-interval 5
set -g status-position bottom
set -g status-justify left

# Status bar length
set -g status-left-length 50
set -g status-right-length 100

# Status bar colors
set -g status-style bg=colour234,fg=colour137

# Left status: session name + customer context (critical for MSSP!)
set -g status-left "#[fg=colour232,bg=colour166,bold] #S #[fg=colour166,bg=colour234]#[fg=colour226,bg=colour234,bold] #{?CUSTOMER_CONTEXT,üè¢ #(echo $CUSTOMER_CONTEXT),} "

# Right status: host, date, time
set -g status-right "#[fg=colour233,bg=colour241,bold] %Y-%m-%d #[fg=colour233,bg=colour245,bold] %H:%M #[fg=colour232,bg=colour166,bold] #H "

# Window status
setw -g window-status-current-style fg=colour81,bg=colour238,bold
setw -g window-status-current-format " #I:#W#F "

setw -g window-status-style fg=colour138,bg=colour235,none
setw -g window-status-format " #I:#W#F "

# Pane border colors
set -g pane-border-style fg=colour238
set -g pane-active-border-style fg=colour166

# Message colors
set -g message-style fg=colour232,bg=colour166,bold

# ----------------------------
# Pane title (shows current command + path)
# ----------------------------
set -g pane-border-status top
set -g pane-border-format "#[fg=colour166]#{pane_index} #[fg=colour245]#{pane_current_command} #[fg=colour238]#{pane_current_path}"

# ----------------------------
# Quick session switching
# ----------------------------
bind-key C-j choose-tree

# ----------------------------
# Synchronize panes (useful for running same command on multiple servers)
# ----------------------------
bind S set-window-option synchronize-panes\; display-message "Synchronize panes: #{?pane_synchronized,ON,OFF}"

# ----------------------------
# Clear history and screen
# ----------------------------
bind C-k send-keys -R \; clear-history \; display-message "History cleared"

# ----------------------------
# Kill pane without confirmation
# ----------------------------
bind x kill-pane

# ----------------------------
# Monitoring
# ----------------------------
# Highlight window with activity
setw -g monitor-activity on
set -g visual-activity off

# ----------------------------
# Plugin manager (optional - uncomment if you want plugins)
# ----------------------------
# set -g @plugin 'tmux-plugins/tpm'
# set -g @plugin 'tmux-plugins/tmux-sensible'
# set -g @plugin 'tmux-plugins/tmux-resurrect'
# set -g @plugin 'tmux-plugins/tmux-continuum'

# Initialize TPM (keep this line at the very bottom)
# run '~/.tmux/plugins/tpm/tpm'
